## 概念
- 分布式：系统中的多个模块在不同服务器上部署，即可称为分布式系统，如Tomcat和数据库分别部署在不同的服务器上，或两个相同功能的Tomcat分别部署在不同服务器上。
- 高可用：系统中部分节点失效时，其他节点能够接替它继续提供服务，则可认为系统具有高可用性。
- 集群：一个特定领域的软件部署在多台服务器上并作为一个整体提供一类服务，这个整体称为集群。如Zookeeper中的Master和Slave分别部署在多台服务器上，共同组成一个整体提供集中配置服务。在常见的集群中，客户端往往能够连接任意一个节点获得服务，并且当集群中一个节点掉线时，其他节点往往能够自动的接替它继续提供服务，这时候说明集群具有高可用性。
- 负载均衡：请求发送到系统时，通过某些方式把请求均匀分发到多个节点上，使系统中每个节点能够均匀的处理请求负载，则可认为系统是负载均衡的。
- 正向代理和反向代理：系统内部要访问外部网络时，统一通过一个代理服务器把请求转发出去，在外部网络看来就是代理服务器发起的访问，此时代理服务器实现的是正向代理；当外部请求进入系统时，代理服务器把该请求转发到系统中的某台服务器上，对外部请求来说，与之交互的只有代理服务器，此时代理服务器实现的是反向代理。**简单来说，正向代理是代理服务器代替系统内部来访问外部网络的过程，反向代理是外部请求访问系统时通过代理服务器转发到内部服务器的过程**。
#### 分布式：多台服务器协同完成共同的任务
#### 中间件：解耦的桥梁
#### CAP
P > A > C

CAP理论是指在分布式系统设计中，‌一致性（Consistency）、‌可用性（Availability）和‌分区容忍性（Partition Tolerance）这三个特性无法同时满足。一致性指的是所有节点在同一时间看到的数据是一样的；可用性指的是系统服务一直保持可用状态，对于每一个请求都能得到响应，而不会出现超时或错误；分区容忍性是指当网络发生分区（即网络中的某些部分无法与其他部分通信）时，系统仍然能够继续运作。

P为什么必然存在：大规模分布式环境中，网络分区几乎是不可避免的。网络分区是指系统中的节点之间无法互相通信或通信延迟非常高的情况。 必然存在（网络中断或者OS压力比较大都会导致网络延迟）

#### BASE 原则

- Basically Available：基本可用性，即允许分区失败，出了问题仅服务降级。
- Soft-State：软状态，即允许异步。
- Eventual Consistency：最终一致性，允许数据最终一致性，而不是时刻一致。

BASE理论是对‌CAP定理的一种实用化延伸，强调在分布式系统中适当放宽对强一致性的要求，以换取更高的可用性和系统性能。其核心思想是：我们无法做到强一致，但每个应用可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性。

#### 发布
1. 蓝绿发布
2. 滚动发布
3. 灰度发布（金丝雀）
#### 微服务
1. x (水平复制 增加实例)
2. y (服务拆分 分布式)
3. z (数据分片 分库分表)

## 知识点
- 系统设计：隔离系统变化点
- 短信验证码先存redis再发送短信
- 状态（操作前状态+事件）| 取消状态（90/91/92 后面一位可以设置取消前的状态值）
- Canal配置很多库
- ribbon饥饿加载

#### 提升QPS
- 提高并发数
    1. 能用多线程用多线程
    2. 增加各种连接数：Tomcat/MySQL/Redis等等
    3. 服务无状态，便于横向扩展，扩机器
    4. 让服务能力对等（serviceUrl 打乱顺序）
- 减少响应时间
    1. 异步（最终一致性，不需要及时）流量削峰
    2. 缓存（减少DB读取，减少磁盘IO，读多写少）
    3. 数据库优化
    4. 多的数据，分批次返回
    5. 减少微服务调用链
    6. 长连接（不要轮询）
#### 接口安全
1. xss：在正常用户请求中执行了黑客提供的恶意代码，问题出在用户数据没有过滤转义。jsoup、spring-htmlUtils、owasp-java-html-sanitizer
2. csrf: 冒充别人的登录信息，问题出在没有防范不信任的调用。人机交互、token
3. DDoS: 流量攻击，只发第一次握手的包，占用流量和服务器资源
#### 高并发优化 如何榨干整台服务器
1. 资源锁细粒度化
    1. 例如秒杀系统：100件库存可以分4份
2. 业务使用锁细粒度化
3. 无锁化（真无锁ThreadLocal 假无锁CAS）
4. 异步+线程池
